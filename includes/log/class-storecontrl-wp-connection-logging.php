<?phpclass StoreContrl_WP_Connection_Logging {    private $log_file;    private $file_pointer;    private $upload_path;    public function __construct() {    	$upload = wp_upload_dir();	    $upload_dir = $upload['basedir'];	    $this->upload_path = '/storecontrl/logs';	    $upload_dir = $upload_dir . $this->upload_path;		$this->log_file = $upload_dir . '/logs_' .date('Y-m-d'). '.txt';		$this->CleanupLogFiles();	}    public function log_file_write( $message ) {        // if file pointer doesn't exist, then open log file        if (!is_resource($this->file_pointer)) {            $this->log_file_open();        }        // define script name        $script_name = pathinfo($_SERVER['PHP_SELF'], PATHINFO_FILENAME);	    date_default_timezone_set('Europe/Amsterdam');        $time = @date('[d/M/Y:H:i:s]');        fwrite($this->file_pointer, "$time ($script_name) $message" . PHP_EOL);        $this->log_file_close();    }    public function log_file_close() {        fclose($this->file_pointer);    }    private function log_file_open() {	    $log_file_default = '';        $log_file = $this->log_file ? $this->log_file : $log_file_default;        $this->file_pointer = fopen($log_file, 'a');    }	public function get_log_file() {		$basedir 	= wp_upload_dir();		$directory 	= $basedir['basedir'];		$directory 	= $directory . '/storecontrl/logs';		$html           = '';		$receivedFile   = sanitize_file_name($_POST['filename']);		$getFile        = $directory . "/" . $receivedFile;		if($file = fopen($getFile, "r") ){			$logs_array = array();			while(!feof($file)) {				$line = fgets($file);				$col = explode(',',$line);				foreach($col as $data) {					$logs_array[] = "<li>". trim($data)."</li>";				}			}			fclose($file);			$html .= '<ul style="margin: 0px;">';			$logs_array = array_reverse($logs_array);			foreach($logs_array as $log) {				$html .= $log;			}			$html .= '</ul>';		}		else{			die("Unable to open file!");		}		wp_send_json( array(			'html' => $html,			'download_url' => $receivedFile		));	}	public function CleanupLogFiles() {        $logDir = __DIR__."/../../../../uploads".$this->upload_path;        if (file_exists($logDir)) {            $files = scandir($logDir);            foreach ($files as $file) {                if ($file != "." && $file != "..") {                    if (preg_match("/logs_(\d{4}-\d{2}-\d{2})\.txt/", $file, $matches)) {                        if (strtotime($matches[1]) >= strtotime("-14 days")) {                            //FILE IS WITHIN 14 DAYS. PRESERVE THE FILE                        }                        else {                            unlink($logDir."/".$file);                        }                    }                    else {                        unlink($logDir."/".$file);                    }                }            }        }    }	public function get_batch_file() {    	// Get the file name		$filename = sanitize_file_name($_POST['filename']);		// Set the directory information		$upload         = wp_upload_dir();		$upload_dir     = $upload['basedir'];		$upload_path    = '/storecontrl/imports';		$directory      = $upload_dir . $upload_path;		// Create a variable that contains the entire path to the file		$file_to_open = $directory . '/' . $filename;		// Try to open the file		if ($opened_file = fopen($file_to_open, 'r')) {			$file_content = fgets($opened_file);		}		else {			$file_content = "Could not open file";		}		wp_send_json( array(			'html' => $file_content		));	}}